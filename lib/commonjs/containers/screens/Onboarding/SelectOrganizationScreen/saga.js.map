{"version":3,"names":["api","_interopRequireWildcard","require","_selectors","_screens","_interopRequireDefault","_actions","_includes","_map","_effects","_error","_navigation","_actions2","_constants","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","getOrganizations","payload","response","organizations","user","select","makeSelectUser","map","data","organization","isSelected","includes","id","put","getOrganizationsSuccess","error","getOrganizationsFailure","handleError","updateOrganizations","organizationIds","updateOrganizationsSuccess","fromMenu","getUserOrganizationsRequest","NavigatorService","back","navigate","Screens","Onboarding","Permission","updateOrganizationsFailure","selectOrganizationScreenSaga","takeLatest","GET_ORGANIZATIONS_REQUEST","UPDATE_ORGANIZATIONS_REQUEST"],"sources":["saga.ts"],"sourcesContent":["/**\n *\n * SelectOrganizationScreen saga\n *\n */\n\nimport * as api from '../../../../api';\nimport { AxiosResponse } from 'axios';\nimport { makeSelectUser } from '../../../../containers/app/selectors';\nimport Screens from '../../../../containers/providers/RoutesProvider/screens';\nimport { getUserOrganizationsRequest } from '../../../../containers/screens/Menu/OrganizationScreen/actions';\nimport { AppUser, Id, Organization, QueryResult } from 'incident-code-core';\nimport includes from 'lodash/includes';\nimport map from 'lodash/map';\nimport { call, put, select, takeLatest } from 'redux-saga/effects';\nimport { OrganizationSelection } from 'types';\nimport { handleError } from '../../../../utils/error';\nimport NavigatorService from '../../../../utils/navigation';\n\nimport {\n  getOrganizationsFailure,\n  getOrganizationsSuccess,\n  updateOrganizationsFailure,\n  updateOrganizationsSuccess,\n} from './actions';\nimport {\n  GET_ORGANIZATIONS_REQUEST,\n  UPDATE_ORGANIZATIONS_REQUEST,\n} from './constants';\nimport {\n  GetOrganizationsRequestAction,\n  UpdateOrganizationsRequestAction,\n} from './types';\n\nexport function* getOrganizations({ payload }: GetOrganizationsRequestAction) {\n  try {\n    const response: AxiosResponse<QueryResult<Organization>> = yield call(\n      api.organizations.getOrganizations,\n      payload,\n    );\n    const user: AppUser = yield select(makeSelectUser());\n    const organizations: OrganizationSelection[] = map(\n      response.data.data,\n      organization => ({\n        ...organization,\n        isSelected: includes(user.organizations, organization.id),\n      }),\n    );\n    yield put(getOrganizationsSuccess(organizations));\n  } catch (error: any) {\n    yield put(getOrganizationsFailure(handleError(error)));\n  }\n}\n\nexport function* updateOrganizations({\n  payload,\n}: UpdateOrganizationsRequestAction):any {\n  try {\n    const organizationIds = map(payload.data, 'id') as Id[];\n    yield call(api.user.updateOrganizations, organizationIds);\n    yield put(\n      updateOrganizationsSuccess({\n        data: organizationIds,\n        fromMenu: payload.fromMenu,\n      }),\n    );\n    if (payload.fromMenu) {\n      yield put(getUserOrganizationsRequest());\n      return yield call(NavigatorService.back);\n    }\n    yield call(NavigatorService.navigate, Screens.Onboarding.Permission);\n  } catch (error: any) {\n    yield put(updateOrganizationsFailure(handleError(error)));\n  }\n}\n\nexport default function* selectOrganizationScreenSaga() {\n  yield takeLatest(GET_ORGANIZATIONS_REQUEST, getOrganizations);\n  yield takeLatest(UPDATE_ORGANIZATIONS_REQUEST, updateOrganizations);\n}\n"],"mappings":"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","ignoreList":[]}