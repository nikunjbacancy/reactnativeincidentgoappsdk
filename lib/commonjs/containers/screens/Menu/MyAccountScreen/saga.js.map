{"version":3,"names":["api","_interopRequireWildcard","require","_actions","_incidentCodeCore","_effects","_error","_actions2","_constants","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","updateName","payload","user","put","updateNameSuccess","error","updateNameFailure","handleError","updatePortrait","options","getAmazonS3Options","uploadPortrait","CompletePortraitUpload","updatePortraitSuccess","updatePortraitFailure","filePath","amazonOptionsResponse","getAmazonUploadOptions","logger","debug","data","warn","response","completeUpload","updateUserPortrait","delay","Error","deletePortrait","deletePortraitSuccess","undefined","deletePortraitFailure","myAccountScreenSaga","takeLatest","UPDATE_MY_ACCOUNT_NAME_REQUEST","UPDATE_PORTRAIT_REQUEST","DELETE_PORTRAIT"],"sources":["saga.ts"],"sourcesContent":["/**\n *\n * MyAccountScreen saga\n *\n */\n\nimport * as api from '../../../../api';\nimport { AxiosResponse } from 'axios';\nimport { updateUserPortrait } from '../../../../containers/app/actions';\nimport {\n  delay,\n  FileUploadOptions,\n  IncidentVideoUploadOptions,\n} from 'incident-code-core';\nimport { call, put, takeLatest } from 'redux-saga/effects';\nimport { handleError } from '../../../../utils/error';\n\nimport {\n  deletePortraitFailure,\n  deletePortraitSuccess,\n  updateNameFailure,\n  updateNameSuccess,\n  updatePortraitFailure,\n  updatePortraitSuccess,\n} from './actions';\nimport {\n  DELETE_PORTRAIT,\n  UPDATE_MY_ACCOUNT_NAME_REQUEST,\n  UPDATE_PORTRAIT_REQUEST,\n} from './constants';\nimport {\n  UpdateMyAccountNameRequestAction,\n  UpdatePortraitRequestAction,\n} from './types';\n\nexport function* updateName({ payload }: UpdateMyAccountNameRequestAction) {\n  try {\n    yield call(api.user.updateName, payload);\n    yield put(updateNameSuccess(payload));\n  } catch (error: any) {\n    yield put(updateNameFailure(handleError(error)));\n  }\n}\n\nexport function* updatePortrait({ payload }: UpdatePortraitRequestAction):any {\n  try {\n    const options : any = yield call(getAmazonS3Options, payload);\n    yield call(api.user.uploadPortrait, options);\n    yield call(CompletePortraitUpload, options);\n    yield put(updatePortraitSuccess());\n  } catch (error: any) {\n    yield put(updatePortraitFailure(handleError(error)));\n  }\n}\n\nfunction* getAmazonS3Options(filePath: string) {\n  try {\n    // get amazon S3 authorization\n    const amazonOptionsResponse: AxiosResponse<IncidentVideoUploadOptions> = yield call(\n      api.user.getAmazonUploadOptions,\n      filePath,\n    );\n\n    api.logger.debug('Get S3 options', 'Success', amazonOptionsResponse.data);\n\n    return amazonOptionsResponse.data;\n  } catch (error: any) {\n    api.logger.warn('Get S3 options', 'Failed', error);\n    yield put(updatePortraitFailure(handleError(error)));\n    return;\n  }\n}\n\nfunction* CompletePortraitUpload(options: FileUploadOptions) {\n  try {\n    const response: AxiosResponse<string> = yield call(\n      api.user.completeUpload,\n      options,\n    );\n    if (response.data) {\n      api.logger.debug('ImageUpload', 'Success');\n      yield put(updateUserPortrait(response.data));\n      return;\n    }\n  } catch (error: any) {\n    api.logger.warn('ImageUpload', 'Failed', error);\n  } finally {\n    yield delay(2000);\n  }\n  throw new Error('Upload image to S3 failed');\n}\n\nfunction* deletePortrait() {\n  try {\n    yield call(api.user.deletePortrait);\n    yield put(deletePortraitSuccess());\n    yield put(updateUserPortrait(undefined));\n  } catch (error: any) {\n    yield put(deletePortraitFailure(handleError(error)));\n  }\n}\n\nexport default function* myAccountScreenSaga() {\n  yield takeLatest(UPDATE_MY_ACCOUNT_NAME_REQUEST, updateName);\n  yield takeLatest(UPDATE_PORTRAIT_REQUEST, updatePortrait);\n  yield takeLatest(DELETE_PORTRAIT, deletePortrait);\n}\n"],"mappings":"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","ignoreList":[]}