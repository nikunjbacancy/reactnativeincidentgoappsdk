{"version":3,"names":["_react","_interopRequireDefault","require","_propTypes","_reactNative","_reactNativeImagePicker","_reactNativeImageResizer","_reactNativeFs","_permission","_reactNativePermissions","e","__esModule","default","_defineProperty","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","MyPhotoUpload","React","Component","constructor","args","maxHeight","props","height","maxWidth","width","format","quality","buttonDisabled","title","photoPickerTitle","storageOptions","skipBackup","path","mediaType","includeBase64","imagePickerProps","permission","requestPhotoLibraryPermissions","setState","onStart","launchImageLibrary","options","response","rotation","originalRotation","onResponse","didCancel","console","log","onCancel","error","onError","customButton","onTapCustomButton","state","imageURI","assets","map","uri","resizedImageUri","ImageResizer","createResizedImage","onResizedImageUri","filePath","Platform","OS","replace","photoData","RNFS","readFile","source","avatarSource","onPhotoSelect","Alert","alert","alertTitle","alertMessage","text","onPress","style","openSettings","Children","children","child","type","Image","cloneElement","componentDidUpdate","onAfterRender","render","createElement","View","styles","container","containerStyle","TouchableOpacity","openImagePicker","disabled","renderChildren","exports","PropTypes","object","string","number","func","onRender","StyleSheet","create","flex","justifyContent","alignItems"],"sources":["MyPhotoUpload.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  View,\n  Image,\n  StyleSheet,\n  TouchableOpacity,\n  Platform,\n  Alert\n} from 'react-native'\n// import ImagePicker from 'react-native-image-picker'\nimport { launchCamera, launchImageLibrary } from 'react-native-image-picker';\nimport ImageResizer from 'react-native-image-resizer'\nimport RNFS from 'react-native-fs'\nimport { requestPhotoLibraryPermissions } from '../../utils/permission';\nimport { openSettings } from 'react-native-permissions';\n\nexport default class MyPhotoUpload extends React.Component {\n  static propTypes = {\n    containerStyle: PropTypes.object,\n    photoPickerTitle: PropTypes.string,\n    maxHeight: PropTypes.number,\n    maxWidth: PropTypes.number,\n    format: PropTypes.string,\n    quality: PropTypes.number,\n    onPhotoSelect: PropTypes.func, // returns the base64 string of uploaded photo\n    onError: PropTypes.func, // if any error occur with response\n    onTapCustomButton: PropTypes.func, // on tap custom button\n    onStart: PropTypes.func, // when user starts (useful for loading, etc)\n    onCancel: PropTypes.func, // when user cancel\n    onResponse: PropTypes.func, // on response exists!\n    onRender: PropTypes.func, // after render\n    onResizedImageUri: PropTypes.func, // when image resized is ready\n    imagePickerProps: PropTypes.object, // react-native-image-picker props\n    alertTitle: PropTypes.string,\n    alertMessage:PropTypes.string,\n  }\n\n  state = {\n    maxHeight: this.props.height || 600,\n    maxWidth: this.props.width || 600,\n    format: this.props.format || 'JPEG',\n    quality: this.props.quality || 100,\n    buttonDisabled: false\n  }\n\n  options = {\n    title: this.props.photoPickerTitle || 'Select Photo',\n    storageOptions: {\n      skipBackup: true,\n      path: 'images',\n      mediaType: 'photo',\n      includeBase64: true\n    },\n    ...this.props.imagePickerProps\n  }\n\n  openImagePicker = async () => {\n\n    var permission = \"\"\n    try {\n      permission = await requestPhotoLibraryPermissions()\n    } catch (e) {\n      permission = e\n    }\n    if (permission === \"granted\") {\n\n\n      this.setState({ buttonDisabled: true })\n      if (this.props.onStart) this.props.onStart()\n\n      // get image from image picker\n      launchImageLibrary(this.options, async response => {\n        this.setState({ buttonDisabled: false })\n\n        let rotation = 0\n        const { originalRotation } = response\n\n\n        if (this.props.onResponse) this.props.onResponse(response)\n\n        if (response.didCancel) {\n          console.log('User cancelled image picker')\n          if (this.props.onCancel) this.props.onCancel('User cancelled image picker')\n          return\n        } else if (response.error) {\n          console.log('ImagePicker Error: ', response.error)\n          if (this.props.onError) this.props.onError(response.error)\n          return\n        } else if (response.customButton) {\n          console.log('User tapped custom button: ', response.customButton)\n          if (this.props.onTapCustomButton) this.props.onTapCustomButton(response.customButton)\n          return\n        }\n\n        let { maxHeight, maxWidth, quality, format } = this.state\n\n        //Determining rotation param\n        if (originalRotation === 90) {\n          rotation = 90\n        } else if (originalRotation === 180) {\n          //For a few images rotation is 180. \n          rotation = -180\n        } else if (originalRotation === 270) {\n          //When taking images with the front camera (selfie), the rotation is 270.\n          rotation = -90\n        }\n\n        var imageURI = \"\"\n        response?.assets.map(({ uri }) => (\n          imageURI = uri\n        ))\n        // resize image\n        const resizedImageUri = await ImageResizer.createResizedImage(\n          imageURI,\n          maxHeight,\n          maxWidth,\n          format,\n          quality,\n          rotation\n        )\n\n        if (this.props.onResizedImageUri) this.props.onResizedImageUri(resizedImageUri)\n\n        const filePath = Platform.OS === 'android' && resizedImageUri.uri.replace\n          ? resizedImageUri.uri.replace('file:/data', '/data')\n          : resizedImageUri.uri\n\n\n        // convert image back to base64 string\n        const photoData = await RNFS.readFile(filePath, 'base64')\n        let source = { uri: resizedImageUri.uri }\n        this.setState({\n          avatarSource: source\n        })\n\n        // handle photo in props functions as data string\n        if (this.props.onPhotoSelect) this.props.onPhotoSelect(photoData)\n      })\n    } else {\n      Alert.alert(\n        this.props.alertTitle,\n        this.props.alertMessage,\n        [\n          {\n            text: \"Cancel\",\n            onPress: () => console.log(\"Cancel Pressed\"),\n            style: \"cancel\"\n          },\n          { text: \"Settings\", onPress: () => openSettings() }\n        ]\n      );\n    }\n  }\n\n  renderChildren = props => {\n    return React.Children.map(props.children, child => {\n      if (child && child.type === Image && this.state.avatarSource) {\n        return React.cloneElement(child, {\n          source: this.state.avatarSource\n        })\n      } else return child\n    })\n  }\n\n  componentDidUpdate() {\n    if (this.props.onAfterRender) this.props.onAfterRender(this.state)\n  }\n\n  render() {\n    return (\n      <View style={[styles.container, this.props.containerStyle]}>\n        <TouchableOpacity\n          onPress={this.openImagePicker}\n          disabled={this.state.buttonDisabled}\n        >\n          {this.renderChildren(this.props)}\n        </TouchableOpacity>\n      </View>\n    )\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center'\n  }\n})\n"],"mappings":"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","ignoreList":[]}