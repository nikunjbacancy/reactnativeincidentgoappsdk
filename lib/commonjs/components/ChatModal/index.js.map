{"version":3,"names":["_assets","require","_selectors","_forEach","_interopRequireDefault","_react","_interopRequireWildcard","_reactIntl","_reactNative","_reactNativeGiftedChat","_reactNativeModal","_hooks","_styled","_v","_IconButton","_messages","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","ChatModal","isVisible","hideModal","onShow","onHide","messages","onMessageSent","isReadMode","formatMessage","useIntl","user","useSelector","makeSelectGiftedChatUser","messagesWithPending","setMessagesWithPending","useState","useEffect","handleSendMessage","useCallback","messagesToSent","forEach","message","pending","prevState","GiftedChat","append","getGiftedChatMessage","text","_id","uuid","createdAt","Date","emptyInput","createElement","View","useNativeDriver","animationIn","animationOut","onBackButtonPress","onBackdropPress","onModalWillShow","onModalWillHide","style","margin","justifyContent","Container","CloseButton","source","images","icClose","onPress","Content","onSend","renderChatFooter","ChatFooter","TagContainer","chatMessage","iNeedHelp","Tag","someoneSuspicious","renderInputToolbar","undefined","styled","theme","colors","white","IconButton","TouchableOpacity","dark","Text","fonts","defaultFamily","normalSize","_default","exports","memo"],"sources":["index.tsx"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport { images } from '../../assets';\nimport { makeSelectGiftedChatUser } from '../../containers/app/selectors';\nimport { Organization } from 'incident-code-core';\nimport forEach from 'lodash/forEach';\nimport React, { FC, memo, useCallback, useEffect, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { View } from 'react-native';\nimport {\n  GiftedChat,\n  IMessage as GiftedChatMessage,\n} from 'react-native-gifted-chat';\nimport Modal from 'react-native-modal';\nimport { useSelector } from '../../utils/hooks';\nimport styled from '../../utils/styled';\nimport uuid from 'uuid/v4';\n\nimport IconButton from '../IconButton';\nimport chatMessage from './messages';\n\ntype Props = {\n  isVisible: boolean;\n  hideModal(): void;\n  onShow?(): void;\n  onHide?(): void;\n  organization: Organization;\n  messages: GiftedChatMessage[];\n  onMessageSent(message: GiftedChatMessage[]): void;\n  isReadMode?: boolean;\n};\n\nconst ChatModal: FC<Props> = ({\n  isVisible,\n  hideModal,\n  onShow,\n  onHide,\n  messages,\n  onMessageSent,\n  isReadMode,\n}) => {\n  const { formatMessage } = useIntl();\n  const user = useSelector(makeSelectGiftedChatUser());\n\n  const [messagesWithPending, setMessagesWithPending] = useState(messages);\n\n  useEffect(() => {\n    setMessagesWithPending(messages);\n  }, [messages]);\n\n  const handleSendMessage = useCallback(\n    (messagesToSent: GiftedChatMessage[]) => {\n      forEach(messagesToSent, message => {\n        message.pending = true;\n      });\n\n      setMessagesWithPending(prevState =>\n        GiftedChat.append(prevState, messagesToSent),\n      );\n\n      onMessageSent(messagesToSent);\n    },\n    [],\n  );\n  const getGiftedChatMessage = useCallback(\n    (text: string): GiftedChatMessage[] => [\n      {\n        _id: uuid(),\n        text,\n        createdAt: new Date(),\n        user,\n      },\n    ],\n    [],\n  );\n  const emptyInput = () => <View />;\n  return (\n    <Modal\n      useNativeDriver={true}\n      animationIn=\"slideInUp\"\n      animationOut=\"slideOutDown\"\n      isVisible={isVisible}\n      onBackButtonPress={hideModal}\n      onBackdropPress={hideModal}\n      onModalWillShow={onShow}\n      onModalWillHide={onHide}\n      style={{ margin: 0, justifyContent: 'flex-end' }}\n    >\n      <Container>\n        <CloseButton source={images.icClose()} onPress={hideModal} />\n        <Content>\n          <GiftedChat\n            user={user}\n            messages={messagesWithPending}\n            onSend={handleSendMessage}\n            renderChatFooter={() => (\n              <ChatFooter>\n                <TagContainer\n                  onPress={() =>\n                    handleSendMessage(\n                      getGiftedChatMessage(\n                        formatMessage(chatMessage.iNeedHelp),\n                      ),\n                    )\n                  }\n                >\n                  <Tag>{formatMessage(chatMessage.iNeedHelp)}</Tag>\n                </TagContainer>\n                <TagContainer\n                  onPress={() =>\n                    handleSendMessage(\n                      getGiftedChatMessage(\n                        formatMessage(chatMessage.someoneSuspicious),\n                      ),\n                    )\n                  }\n                >\n                  <Tag>{formatMessage(chatMessage.someoneSuspicious)}</Tag>\n                </TagContainer>\n              </ChatFooter>\n            )}\n            renderInputToolbar={isReadMode ? emptyInput : undefined}\n          />\n        </Content>\n      </Container>\n    </Modal>\n  );\n};\n\nconst Container = styled.View`\n  background-color: ${({ theme }) => theme.colors.white};\n  border-top-left-radius: 20px;\n  border-top-right-radius: 20px;\n  height: 80%;\n  width: 100%;\n  display: flex;\n  position: relative;\n`;\n\nconst Content = styled.View`\n  flex: 1;\n  padding: 15px 15px 25px;\n`;\n\nconst CloseButton = styled(IconButton as any)`\n  width: 44px;\n  height: 44px;\n  border-radius: 22px;\n  background-color: ${({ theme }) => theme.colors.white};\n  position: absolute;\n  top: -60px;\n  right: 20px;\n`;\n\nconst ChatFooter = styled.View`\n  height: 44px;\n  flex-wrap: wrap;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst TagContainer = styled.TouchableOpacity`\n  border: 0.5px solid ${({ theme }) => theme.colors.dark};\n  justify-content: center;\n  align-items: center;\n  margin-left: 3px;\n  margin-right: 3px;\n  padding: 5px 10px;\n  border-radius: 3px;\n`;\n\nconst Tag = styled.Text`\n  font-family: ${({ theme }) => theme.fonts.defaultFamily};\n  font-size: ${({ theme }) => theme.fonts.normalSize};\n  color: ${({ theme }) => theme.colors.dark};\n  font-weight: 100;\n`;\n\nexport default memo(ChatModal);\n"],"mappings":";;;;;;AACA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,UAAA,GAAAD,OAAA;AAEA,IAAAE,QAAA,GAAAC,sBAAA,CAAAH,OAAA;AACA,IAAAI,MAAA,GAAAC,uBAAA,CAAAL,OAAA;AACA,IAAAM,UAAA,GAAAN,OAAA;AACA,IAAAO,YAAA,GAAAP,OAAA;AACA,IAAAQ,sBAAA,GAAAR,OAAA;AAIA,IAAAS,iBAAA,GAAAN,sBAAA,CAAAH,OAAA;AACA,IAAAU,MAAA,GAAAV,OAAA;AACA,IAAAW,OAAA,GAAAR,sBAAA,CAAAH,OAAA;AACA,IAAAY,EAAA,GAAAT,sBAAA,CAAAH,OAAA;AAEA,IAAAa,WAAA,GAAAV,sBAAA,CAAAH,OAAA;AACA,IAAAc,SAAA,GAAAX,sBAAA,CAAAH,OAAA;AAAqC,SAAAe,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAX,wBAAAW,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAAA,SAAArB,uBAAAa,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAI,UAAA,GAAAJ,CAAA,KAAAK,OAAA,EAAAL,CAAA;AAlBrC;;AA+BA,MAAMmB,SAAoB,GAAGA,CAAC;EAC5BC,SAAS;EACTC,SAAS;EACTC,MAAM;EACNC,MAAM;EACNC,QAAQ;EACRC,aAAa;EACbC;AACF,CAAC,KAAK;EACJ,MAAM;IAAEC;EAAc,CAAC,GAAG,IAAAC,kBAAO,EAAC,CAAC;EACnC,MAAMC,IAAI,GAAG,IAAAC,kBAAW,EAAC,IAAAC,mCAAwB,EAAC,CAAC,CAAC;EAEpD,MAAM,CAACC,mBAAmB,EAAEC,sBAAsB,CAAC,GAAG,IAAAC,eAAQ,EAACV,QAAQ,CAAC;EAExE,IAAAW,gBAAS,EAAC,MAAM;IACdF,sBAAsB,CAACT,QAAQ,CAAC;EAClC,CAAC,EAAE,CAACA,QAAQ,CAAC,CAAC;EAEd,MAAMY,iBAAiB,GAAG,IAAAC,kBAAW,EAClCC,cAAmC,IAAK;IACvC,IAAAC,gBAAO,EAACD,cAAc,EAAEE,OAAO,IAAI;MACjCA,OAAO,CAACC,OAAO,GAAG,IAAI;IACxB,CAAC,CAAC;IAEFR,sBAAsB,CAACS,SAAS,IAC9BC,iCAAU,CAACC,MAAM,CAACF,SAAS,EAAEJ,cAAc,CAC7C,CAAC;IAEDb,aAAa,CAACa,cAAc,CAAC;EAC/B,CAAC,EACD,EACF,CAAC;EACD,MAAMO,oBAAoB,GAAG,IAAAR,kBAAW,EACrCS,IAAY,IAA0B,CACrC;IACEC,GAAG,EAAE,IAAAC,UAAI,EAAC,CAAC;IACXF,IAAI;IACJG,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC;IACrBrB;EACF,CAAC,CACF,EACD,EACF,CAAC;EACD,MAAMsB,UAAU,GAAGA,CAAA,kBAAM/D,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAAC7D,YAAA,CAAA8D,IAAI,MAAE,CAAC;EACjC,oBACEjE,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAAC3D,iBAAA,CAAAY,OAAK;IACJiD,eAAe,EAAE,IAAK;IACtBC,WAAW,EAAC,WAAW;IACvBC,YAAY,EAAC,cAAc;IAC3BpC,SAAS,EAAEA,SAAU;IACrBqC,iBAAiB,EAAEpC,SAAU;IAC7BqC,eAAe,EAAErC,SAAU;IAC3BsC,eAAe,EAAErC,MAAO;IACxBsC,eAAe,EAAErC,MAAO;IACxBsC,KAAK,EAAE;MAAEC,MAAM,EAAE,CAAC;MAAEC,cAAc,EAAE;IAAW;EAAE,gBAEjD3E,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACY,SAAS,qBACR5E,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACa,WAAW;IAACC,MAAM,EAAEC,cAAM,CAACC,OAAO,CAAC,CAAE;IAACC,OAAO,EAAEhD;EAAU,CAAE,CAAC,eAC7DjC,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACkB,OAAO,qBACNlF,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAAC5D,sBAAA,CAAAmD,UAAU;IACTd,IAAI,EAAEA,IAAK;IACXL,QAAQ,EAAEQ,mBAAoB;IAC9BuC,MAAM,EAAEnC,iBAAkB;IAC1BoC,gBAAgB,EAAEA,CAAA,kBAChBpF,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACqB,UAAU,qBACTrF,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACsB,YAAY;MACXL,OAAO,EAAEA,CAAA,KACPjC,iBAAiB,CACfS,oBAAoB,CAClBlB,aAAa,CAACgD,iBAAW,CAACC,SAAS,CACrC,CACF;IACD,gBAEDxF,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACyB,GAAG,QAAElD,aAAa,CAACgD,iBAAW,CAACC,SAAS,CAAO,CACpC,CAAC,eACfxF,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACsB,YAAY;MACXL,OAAO,EAAEA,CAAA,KACPjC,iBAAiB,CACfS,oBAAoB,CAClBlB,aAAa,CAACgD,iBAAW,CAACG,iBAAiB,CAC7C,CACF;IACD,gBAED1F,MAAA,CAAAiB,OAAA,CAAA+C,aAAA,CAACyB,GAAG,QAAElD,aAAa,CAACgD,iBAAW,CAACG,iBAAiB,CAAO,CAC5C,CACJ,CACZ;IACFC,kBAAkB,EAAErD,UAAU,GAAGyB,UAAU,GAAG6B;EAAU,CACzD,CACM,CACA,CACN,CAAC;AAEZ,CAAC;AAED,MAAMhB,SAAS,GAAGiB,eAAM,CAAC5B,IAAI;AAC7B,sBAAsB,CAAC;EAAE6B;AAAM,CAAC,KAAKA,KAAK,CAACC,MAAM,CAACC,KAAK;AACvD;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAED,MAAMd,OAAO,GAAGW,eAAM,CAAC5B,IAAI;AAC3B;AACA;AACA,CAAC;AAED,MAAMY,WAAW,GAAG,IAAAgB,eAAM,EAACI,mBAAiB,CAAC;AAC7C;AACA;AACA;AACA,sBAAsB,CAAC;EAAEH;AAAM,CAAC,KAAKA,KAAK,CAACC,MAAM,CAACC,KAAK;AACvD;AACA;AACA;AACA,CAAC;AAED,MAAMX,UAAU,GAAGQ,eAAM,CAAC5B,IAAI;AAC9B;AACA;AACA;AACA;AACA,CAAC;AAED,MAAMqB,YAAY,GAAGO,eAAM,CAACK,gBAAgB;AAC5C,wBAAwB,CAAC;EAAEJ;AAAM,CAAC,KAAKA,KAAK,CAACC,MAAM,CAACI,IAAI;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAED,MAAMV,GAAG,GAAGI,eAAM,CAACO,IAAI;AACvB,iBAAiB,CAAC;EAAEN;AAAM,CAAC,KAAKA,KAAK,CAACO,KAAK,CAACC,aAAa;AACzD,eAAe,CAAC;EAAER;AAAM,CAAC,KAAKA,KAAK,CAACO,KAAK,CAACE,UAAU;AACpD,WAAW,CAAC;EAAET;AAAM,CAAC,KAAKA,KAAK,CAACC,MAAM,CAACI,IAAI;AAC3C;AACA,CAAC;AAAC,IAAAK,QAAA,GAAAC,OAAA,CAAAxF,OAAA,gBAEa,IAAAyF,WAAI,EAAC3E,SAAS,CAAC","ignoreList":[]}