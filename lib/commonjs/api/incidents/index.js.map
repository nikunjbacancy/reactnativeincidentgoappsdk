{"version":3,"names":["_replace","_interopRequireDefault","require","_rnFetchBlob","_device","_location","_video","_axios","e","__esModule","default","endpoints","exports","incidents","_default","getAmazonOptions","incident","filePath","newFilePath","isIos","replace","fileStat","RNFetchBlob","fs","stat","geoPoint","getCachedFineGeoPoint","amazonOptionsResponse","axios","post","format","getFileExtension","size","id","location","data","createIncident","request","getVideo","videoId","get","getVideos","incidentId","uploadVideo","options","fetch","method","host","path","headers","wrap","deleteLocalVideo","deleteIncident","delete","doIncidentAction","incidentActionRequest","getIncidents","query","params","getIncident","startChat","incidentChatRequest","getChat","addLocation","latLng","startEscort","getEscort","updateEscortState","incidentEscortId","patch","getPassiveEscort","createPassiveEscort","passiveToActiveEscort","passiveToPanicEscort","updatePassiveEscortLog","updatePassiveEscortState","updateIncidentChatHistory"],"sources":["index.ts"],"sourcesContent":["/* eslint-disable no-console */\nimport { AxiosResponse } from 'axios';\nimport {\n  History,\n  Id,\n  Incident,\n  IncidentActionRequest,\n  IncidentChat,\n  IncidentChatRequest,\n  IncidentEscort,\n  IncidentEscortRequest,\n  IncidentPassive,\n  IncidentPassiveEscortRequest,\n  IncidentPassiveLogRequest,\n  IncidentRequest,\n  IncidentVideo,\n  IncidentVideoRequest,\n  IncidentVideoUploadOptions,\n  LatLng,\n  ObjectId,\n  QueryResult,\n  QuerySpecification,\n} from 'incident-code-core';\nimport replace from 'lodash/replace';\nimport RNFetchBlob from 'rn-fetch-blob';\nimport { isIos } from '../../utils/device';\nimport { getCachedFineGeoPoint } from '../../utils/location';\nimport { deleteLocalVideo, getFileExtension } from '../../utils/video';\n\nimport axios from '../axios';\n\nexport const endpoints = {\n  incidents: 'incidents',\n};\n\nexport default {\n  getAmazonOptions: async (incident: Incident, filePath: string) => {\n    const newFilePath = isIos ? replace(filePath, 'file://', '') : filePath;\n    const fileStat = await RNFetchBlob.fs.stat(newFilePath);\n    const geoPoint = await getCachedFineGeoPoint();\n\n    // @ts-ignore\n    const amazonOptionsResponse: AxiosResponse<IncidentVideoUploadOptions> = await axios.post<\n      IncidentVideoRequest,\n      IncidentVideoUploadOptions\n    >(`${endpoints.incidents}/video`, {\n      format: getFileExtension(filePath),\n      size: fileStat.size,\n      incident: incident.id,\n      location: geoPoint,\n    });\n\n    amazonOptionsResponse.data.filePath = newFilePath;\n\n    return amazonOptionsResponse;\n  },\n  createIncident: async (request: IncidentRequest = {} as IncidentRequest) => {\n    const geoPoint = await getCachedFineGeoPoint();\n    return axios.post<Incident>(endpoints.incidents, {\n      ...request,\n      location: geoPoint,\n    });\n  },\n  getVideo: (videoId?: Id) =>\n    axios.get<IncidentVideo>(`${endpoints.incidents}/videos/${videoId}`),\n  getVideos: (incidentId?: Id) =>\n    axios.get<QueryResult<IncidentVideo>>(\n      `${endpoints.incidents}/${incidentId}/videos/`,\n    ),\n  uploadVideo: async (options: IncidentVideoUploadOptions) => {\n    if (!options.filePath) return;\n    // upload to s3\n    await RNFetchBlob.fetch(\n      options.method as any,\n      `https://${options.host}${options.path}`,\n      options.headers as any,\n      RNFetchBlob.wrap(options.filePath),\n    );\n\n    // delete video after upload\n    await deleteLocalVideo(options.filePath);\n  },\n  deleteIncident: (id?: Id) => axios.delete(`${endpoints.incidents}/${id}`),\n  doIncidentAction: (incidentActionRequest: IncidentActionRequest) =>\n    axios.post(`${endpoints.incidents}/action`, incidentActionRequest),\n  getIncidents: (query: QuerySpecification) =>\n    axios.get<QueryResult<Incident>>(`${endpoints.incidents}/self`, {\n      params: query,\n    }),\n  getIncident: (id: Id) => axios.get<Incident>(`${endpoints.incidents}/${id}`),\n  startChat: (incidentChatRequest: IncidentChatRequest) =>\n    axios.post(`${endpoints.incidents}/chat`, incidentChatRequest),\n  getChat: (id: Id) =>\n    axios.get<IncidentChat>(`${endpoints.incidents}/${id}/chat`),\n  addLocation: (id: Id, latLng: LatLng) =>\n    axios.post(`${endpoints.incidents}/${id}/location`, latLng),\n  startEscort: async (\n    request: IncidentEscortRequest,\n  ): Promise<AxiosResponse<Incident>> =>\n    axios.post(`${endpoints.incidents}/escort`, request),\n  getEscort: async (incidentId: Id): Promise<AxiosResponse<IncidentEscort>> =>\n    axios.get(`${endpoints.incidents}/${incidentId}/escort`),\n  updateEscortState: (\n    incidentEscortId: string | ObjectId | undefined,\n    request: { state: string; comment?: string },\n  ) =>\n    axios.patch(\n      `${endpoints.incidents}/${incidentEscortId}/escort/state`,\n      request,\n    ),\n  getPassiveEscort: async (\n    incidentId: Id,\n  ): Promise<AxiosResponse<IncidentPassive>> =>\n    axios.get(`${endpoints.incidents}/${incidentId}/escort/passive`),\n  createPassiveEscort: async (\n    request: IncidentPassiveEscortRequest = {} as IncidentPassiveEscortRequest,\n  ) => {\n    return axios.post<Incident>(`${endpoints.incidents}/escort/passive`, {\n      ...request,\n    });\n  },\n  passiveToActiveEscort: async (request: Incident) => {\n    return axios.post<void>(`${endpoints.incidents}/escort/passive/expired`, {\n      ...request,\n    });\n  },\n  passiveToPanicEscort: async (request: Incident) => {\n    return axios.post<void>(`${endpoints.incidents}/escort/passive/panic`, {\n      ...request,\n    });\n  },\n  updatePassiveEscortLog: async (\n    request: IncidentPassiveLogRequest = {} as IncidentPassiveLogRequest,\n  ) => {\n    return axios.post<void>(`${endpoints.incidents}/escort/passive/log`, {\n      ...request,\n    });\n  },\n  updatePassiveEscortState: async (\n    incidentEscortId: string | ObjectId | undefined,\n    request: { state: string; comment?: string },\n  ) =>\n    axios.patch(\n      `${endpoints.incidents}/${incidentEscortId}/escort/passive/state`,\n      request,\n    ),\n  updateIncidentChatHistory: async (incidentId: Id, request: History) =>\n    axios.post<void>(`${endpoints.incidents}/${incidentId}/history`, request),\n};\n"],"mappings":"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","ignoreList":[]}