{"version":3,"names":["api","PERMISSIONS","request","RESULTS","Toast","call","put","takeLatest","getContacts","isAndroid","handleError","NavigatorService","addContactFailure","addContactSuccess","getContactsFailure","getContactsSuccess","ADD_CONTACT_REQUEST","GET_CONTACTS_REQUEST","getContactsSaga","permission","ANDROID","READ_CONTACTS","IOS","CONTACTS","permissionStatus","GRANTED","contacts","filteredContacts","error","addContact","payload","id","response","user","data","back","_error$response","show","message","position","positions","CENTER","addContactScreenSaga"],"sources":["saga.ts"],"sourcesContent":["/**\n *\n * AddContactScreen saga\n *\n */\n\nimport * as api from '../../../../../api';\nimport { AxiosResponse } from 'axios';\nimport { AppUserContact } from 'incident-code-core';\nimport { PERMISSIONS, request, RESULTS } from 'react-native-permissions';\nimport Toast from 'react-native-root-toast';\nimport { call, put, takeLatest } from 'redux-saga/effects';\nimport { getContacts, isAndroid } from '../../../../../utils/device';\nimport { handleError } from '../../../../../utils/error';\nimport NavigatorService from '../../../../../utils/navigation';\n\nimport {\n  addContactFailure,\n  addContactSuccess,\n  getContactsFailure,\n  getContactsSuccess,\n} from './actions';\nimport { ADD_CONTACT_REQUEST, GET_CONTACTS_REQUEST } from './constants';\nimport { AddContactRequestAction } from './types';\n\nfunction* getContactsSaga():any {\n  try {\n    const permission = isAndroid\n      ? PERMISSIONS.ANDROID.READ_CONTACTS\n      : PERMISSIONS.IOS.CONTACTS;\n    const permissionStatus = yield call(request, permission);\n    //(\"contacts permission ==>\",permission)\n    //(\"contacts permissionStatus ==>\",permissionStatus)\n    if (permissionStatus === RESULTS.GRANTED) {\n      const contacts: AppUserContact[] = yield call(getContacts);\n      //(\"contacts ==>\",contacts)\n      return yield put(\n        getContactsSuccess({\n          contacts,\n          filteredContacts: contacts,\n          permissionStatus,\n        }),\n      );\n    }\n    return yield put(\n      getContactsSuccess({\n        contacts: [],\n        filteredContacts: [],\n        permissionStatus,\n      }),\n    );\n  } catch (error: any) {\n    yield put(getContactsFailure(handleError(error)));\n  }\n}\n\nfunction* addContact({ payload }: AddContactRequestAction) {\n  delete payload.id; // to let api generate id\n\n  try {\n    const response: AxiosResponse<AppUserContact> = yield call(\n      api.user.addContact,\n      payload,\n    );\n    yield put(addContactSuccess(response.data));\n    yield call(NavigatorService.back);\n  } catch (error: any) {\n    Toast.show(error?.response?.data?.message, {\n      position: Toast.positions.CENTER,\n    });\n    yield put(addContactFailure(handleError(error)));\n  }\n}\n\nexport default function* addContactScreenSaga() {\n  yield takeLatest(GET_CONTACTS_REQUEST, getContactsSaga);\n  yield takeLatest(ADD_CONTACT_REQUEST, addContact);\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAO,KAAKA,GAAG,MAAM,oBAAoB;AAGzC,SAASC,WAAW,EAAEC,OAAO,EAAEC,OAAO,QAAQ,0BAA0B;AACxE,OAAOC,KAAK,MAAM,yBAAyB;AAC3C,SAASC,IAAI,EAAEC,GAAG,EAAEC,UAAU,QAAQ,oBAAoB;AAC1D,SAASC,WAAW,EAAEC,SAAS,QAAQ,6BAA6B;AACpE,SAASC,WAAW,QAAQ,4BAA4B;AACxD,OAAOC,gBAAgB,MAAM,iCAAiC;AAE9D,SACEC,iBAAiB,EACjBC,iBAAiB,EACjBC,kBAAkB,EAClBC,kBAAkB,QACb,WAAW;AAClB,SAASC,mBAAmB,EAAEC,oBAAoB,QAAQ,aAAa;AAGvE,UAAUC,eAAeA,CAAA,EAAO;EAC9B,IAAI;IACF,MAAMC,UAAU,GAAGV,SAAS,GACxBR,WAAW,CAACmB,OAAO,CAACC,aAAa,GACjCpB,WAAW,CAACqB,GAAG,CAACC,QAAQ;IAC5B,MAAMC,gBAAgB,GAAG,MAAMnB,IAAI,CAACH,OAAO,EAAEiB,UAAU,CAAC;IACxD;IACA;IACA,IAAIK,gBAAgB,KAAKrB,OAAO,CAACsB,OAAO,EAAE;MACxC,MAAMC,QAA0B,GAAG,MAAMrB,IAAI,CAACG,WAAW,CAAC;MAC1D;MACA,OAAO,MAAMF,GAAG,CACdS,kBAAkB,CAAC;QACjBW,QAAQ;QACRC,gBAAgB,EAAED,QAAQ;QAC1BF;MACF,CAAC,CACH,CAAC;IACH;IACA,OAAO,MAAMlB,GAAG,CACdS,kBAAkB,CAAC;MACjBW,QAAQ,EAAE,EAAE;MACZC,gBAAgB,EAAE,EAAE;MACpBH;IACF,CAAC,CACH,CAAC;EACH,CAAC,CAAC,OAAOI,KAAU,EAAE;IACnB,MAAMtB,GAAG,CAACQ,kBAAkB,CAACJ,WAAW,CAACkB,KAAK,CAAC,CAAC,CAAC;EACnD;AACF;AAEA,UAAUC,UAAUA,CAAC;EAAEC;AAAiC,CAAC,EAAE;EACzD,OAAOA,OAAO,CAACC,EAAE,CAAC,CAAC;;EAEnB,IAAI;IACF,MAAMC,QAAuC,GAAG,MAAM3B,IAAI,CACxDL,GAAG,CAACiC,IAAI,CAACJ,UAAU,EACnBC,OACF,CAAC;IACD,MAAMxB,GAAG,CAACO,iBAAiB,CAACmB,QAAQ,CAACE,IAAI,CAAC,CAAC;IAC3C,MAAM7B,IAAI,CAACM,gBAAgB,CAACwB,IAAI,CAAC;EACnC,CAAC,CAAC,OAAOP,KAAU,EAAE;IAAA,IAAAQ,eAAA;IACnBhC,KAAK,CAACiC,IAAI,CAACT,KAAK,aAALA,KAAK,gBAAAQ,eAAA,GAALR,KAAK,CAAEI,QAAQ,cAAAI,eAAA,gBAAAA,eAAA,GAAfA,eAAA,CAAiBF,IAAI,cAAAE,eAAA,uBAArBA,eAAA,CAAuBE,OAAO,EAAE;MACzCC,QAAQ,EAAEnC,KAAK,CAACoC,SAAS,CAACC;IAC5B,CAAC,CAAC;IACF,MAAMnC,GAAG,CAACM,iBAAiB,CAACF,WAAW,CAACkB,KAAK,CAAC,CAAC,CAAC;EAClD;AACF;AAEA,eAAe,UAAUc,oBAAoBA,CAAA,EAAG;EAC9C,MAAMnC,UAAU,CAACU,oBAAoB,EAAEC,eAAe,CAAC;EACvD,MAAMX,UAAU,CAACS,mBAAmB,EAAEa,UAAU,CAAC;AACnD","ignoreList":[]}