{"version":3,"names":["Screens","call","put","takeLatest","openSettings","isAndroid","checkGPSStatus","NavigatorService","checkBlockedPermission","requestAllPermissions","showOpenConfigMessage","allPermissionsSuccess","ALL_PERMISSIONS_REQUEST","GO_TO_NEXT_SCREEN","showMessageAndOpenPermissionConfigScreen","message","requestAllPermissionsSaga","payload","goToNextScreen","error","isActive","nextScreen","Onboarding","PermissionLocation","ActivateGPS","Home","Index","navigate","permissionScreenSaga"],"sources":["saga.ts"],"sourcesContent":["/**\n *\n * PermissionScreen saga\n *\n */\n\nimport Screens from '../../../../containers/providers/RoutesProvider/screens';\nimport { call, put, takeLatest } from 'redux-saga/effects';\nimport { openSettings } from 'react-native-permissions';\nimport { isAndroid } from '../../../../utils/device';\nimport { checkGPSStatus } from '../../../../utils/location';\nimport NavigatorService from '../../../../utils/navigation';\nimport {\n  checkBlockedPermission,\n  requestAllPermissions,\n  showOpenConfigMessage\n} from '../../../../utils/permission';\n\nimport { allPermissionsSuccess } from './actions';\nimport { ALL_PERMISSIONS_REQUEST, GO_TO_NEXT_SCREEN } from './constants';\nimport { AllPermissionsRequestAction } from './types';\n\nfunction* showMessageAndOpenPermissionConfigScreen(message: string) {\n  yield call(showOpenConfigMessage, message);\n  yield call(openSettings);\n}\n\nexport function* requestAllPermissionsSaga({\n  payload,\n}: AllPermissionsRequestAction) {\n  try {\n    yield call(checkBlockedPermission);\n    yield call(requestAllPermissions);\n    yield call(goToNextScreen);\n\n  } catch (error) {\n    yield call(showMessageAndOpenPermissionConfigScreen, payload);\n    yield call(goToNextScreen);\n    \n    // yield put(getAllGeofenceRequest(\"123\"))\n  }\n}\n\nfunction* goToNextScreen() {\n  if (isAndroid) {\n    yield put(allPermissionsSuccess());\n    const isActive = yield call(checkGPSStatus);\n    const nextScreen = isActive\n      ? Screens.Onboarding.PermissionLocation\n      : Screens.Onboarding.ActivateGPS;\n    if (nextScreen === Screens.Home.Index) {\n      yield call(NavigatorService.navigate, Screens.Onboarding.PermissionLocation);\n      // const isEnabled = yield call(checkBluetoothStatus);\n      // if (isEnabled) {\n      //   yield call(NavigatorService.navigate, nextScreen);\n      //   const beaconInfo = yield call(setUpBeaconInfo);\n      //   yield put(beaconRegistrationRequest(beaconInfo));\n      // }\n      // else {\n      //   yield call(NavigatorService.navigate, nextScreen);\n      // }\n    }\n    else {\n      yield call(NavigatorService.navigate, nextScreen);\n    }\n  } else {\n\n    yield put(allPermissionsSuccess());\n    yield call(NavigatorService.navigate, Screens.Onboarding.PermissionLocation);\n\n    // const location = yield call(getCachedFineGeoPoint);\n    // console.log(\"location:::::===>\" + JSON.stringify(location));\n    // if (location) {\n    //   // yield put(allPermissionsSuccess());\n    //   yield call(NavigatorService.navigate, Screens.Onboarding.PermissionLocation);\n    // }\n    // else {\n    //   // yield put(allPermissionsSuccess());\n    //   yield call(NavigatorService.navigate, Screens.Onboarding.PermissionLocation);\n    // }\n  }\n}\n\nexport default function* permissionScreenSaga() {\n  yield takeLatest(ALL_PERMISSIONS_REQUEST, requestAllPermissionsSaga);\n  yield takeLatest(GO_TO_NEXT_SCREEN, goToNextScreen);\n}\n\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,OAAO,MAAM,yDAAyD;AAC7E,SAASC,IAAI,EAAEC,GAAG,EAAEC,UAAU,QAAQ,oBAAoB;AAC1D,SAASC,YAAY,QAAQ,0BAA0B;AACvD,SAASC,SAAS,QAAQ,0BAA0B;AACpD,SAASC,cAAc,QAAQ,4BAA4B;AAC3D,OAAOC,gBAAgB,MAAM,8BAA8B;AAC3D,SACEC,sBAAsB,EACtBC,qBAAqB,EACrBC,qBAAqB,QAChB,8BAA8B;AAErC,SAASC,qBAAqB,QAAQ,WAAW;AACjD,SAASC,uBAAuB,EAAEC,iBAAiB,QAAQ,aAAa;AAGxE,UAAUC,wCAAwCA,CAACC,OAAe,EAAE;EAClE,MAAMd,IAAI,CAACS,qBAAqB,EAAEK,OAAO,CAAC;EAC1C,MAAMd,IAAI,CAACG,YAAY,CAAC;AAC1B;AAEA,OAAO,UAAUY,yBAAyBA,CAAC;EACzCC;AAC2B,CAAC,EAAE;EAC9B,IAAI;IACF,MAAMhB,IAAI,CAACO,sBAAsB,CAAC;IAClC,MAAMP,IAAI,CAACQ,qBAAqB,CAAC;IACjC,MAAMR,IAAI,CAACiB,cAAc,CAAC;EAE5B,CAAC,CAAC,OAAOC,KAAK,EAAE;IACd,MAAMlB,IAAI,CAACa,wCAAwC,EAAEG,OAAO,CAAC;IAC7D,MAAMhB,IAAI,CAACiB,cAAc,CAAC;;IAE1B;EACF;AACF;AAEA,UAAUA,cAAcA,CAAA,EAAG;EACzB,IAAIb,SAAS,EAAE;IACb,MAAMH,GAAG,CAACS,qBAAqB,CAAC,CAAC,CAAC;IAClC,MAAMS,QAAQ,GAAG,MAAMnB,IAAI,CAACK,cAAc,CAAC;IAC3C,MAAMe,UAAU,GAAGD,QAAQ,GACvBpB,OAAO,CAACsB,UAAU,CAACC,kBAAkB,GACrCvB,OAAO,CAACsB,UAAU,CAACE,WAAW;IAClC,IAAIH,UAAU,KAAKrB,OAAO,CAACyB,IAAI,CAACC,KAAK,EAAE;MACrC,MAAMzB,IAAI,CAACM,gBAAgB,CAACoB,QAAQ,EAAE3B,OAAO,CAACsB,UAAU,CAACC,kBAAkB,CAAC;MAC5E;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACF,CAAC,MACI;MACH,MAAMtB,IAAI,CAACM,gBAAgB,CAACoB,QAAQ,EAAEN,UAAU,CAAC;IACnD;EACF,CAAC,MAAM;IAEL,MAAMnB,GAAG,CAACS,qBAAqB,CAAC,CAAC,CAAC;IAClC,MAAMV,IAAI,CAACM,gBAAgB,CAACoB,QAAQ,EAAE3B,OAAO,CAACsB,UAAU,CAACC,kBAAkB,CAAC;;IAE5E;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;EACF;AACF;AAEA,eAAe,UAAUK,oBAAoBA,CAAA,EAAG;EAC9C,MAAMzB,UAAU,CAACS,uBAAuB,EAAEI,yBAAyB,CAAC;EACpE,MAAMb,UAAU,CAACU,iBAAiB,EAAEK,cAAc,CAAC;AACrD","ignoreList":[]}