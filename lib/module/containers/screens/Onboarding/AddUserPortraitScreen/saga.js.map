{"version":3,"names":["api","updateUserPortrait","delay","call","put","takeLatest","handleError","updatePortraitFailure","updatePortraitSuccess","UPDATE_PORTRAIT_REQUEST","updatePortrait","payload","options","getAmazonS3Options","user","uploadPortrait","CompletePortraitUpload","error","filePath","amazonOptionsResponse","getAmazonUploadOptions","logger","debug","data","warn","response","completeUpload","Error","myAccountScreenSaga"],"sources":["saga.ts"],"sourcesContent":["/**\n *\n * AddUserPortraitScreen saga\n *\n */\nimport * as api from '../../../../api';\nimport { AxiosResponse } from 'axios';\nimport { updateUserPortrait } from '../../../../containers/app/actions';\nimport {\n  delay,\n  FileUploadOptions,\n  IncidentVideoUploadOptions,\n} from 'incident-code-core';\nimport { call, put, takeLatest } from 'redux-saga/effects';\nimport { handleError } from '../../../../utils/error';\n\nimport { updatePortraitFailure, updatePortraitSuccess } from './actions';\nimport { UPDATE_PORTRAIT_REQUEST } from './constants';\nimport { UpdatePortraitRequestAction } from './types';\n\nexport function* updatePortrait({ payload }: UpdatePortraitRequestAction):any {\n  try {\n    const options: any = yield call(getAmazonS3Options, payload);\n    yield call(api.user.uploadPortrait, options);\n    yield call(CompletePortraitUpload, options);\n    yield put(updatePortraitSuccess());\n  } catch (error: any) {\n    yield put(updatePortraitFailure(handleError(error)));\n  }\n}\n\nfunction* getAmazonS3Options(filePath: string) {\n  try {\n    // get amazon S3 authorization\n    const amazonOptionsResponse: AxiosResponse<IncidentVideoUploadOptions> = yield call(\n      api.user.getAmazonUploadOptions,\n      filePath,\n    );\n\n    api.logger.debug('Get S3 options', 'Success', amazonOptionsResponse.data);\n\n    return amazonOptionsResponse.data;\n  } catch (error: any) {\n    api.logger.warn('Get S3 options', 'Failed', error);\n    yield put(updatePortraitFailure(handleError(error)));\n    return;\n  }\n}\n\nfunction* CompletePortraitUpload(options: FileUploadOptions) {\n  try {\n    const response: AxiosResponse<string> = yield call(\n      api.user.completeUpload,\n      options,\n    );\n    if (response.data) {\n      api.logger.debug('ImageUpload', 'Success');\n      yield put(updateUserPortrait(response.data));\n      return;\n    }\n  } catch (error) {\n    api.logger.warn('ImageUpload', 'Failed', error);\n  } finally {\n    yield delay(2000);\n  }\n  throw new Error('Upload image to S3 failed');\n}\n\nexport default function* myAccountScreenSaga() {\n  yield takeLatest(UPDATE_PORTRAIT_REQUEST, updatePortrait);\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAO,KAAKA,GAAG,MAAM,iBAAiB;AAEtC,SAASC,kBAAkB,QAAQ,oCAAoC;AACvE,SACEC,KAAK,QAGA,oBAAoB;AAC3B,SAASC,IAAI,EAAEC,GAAG,EAAEC,UAAU,QAAQ,oBAAoB;AAC1D,SAASC,WAAW,QAAQ,yBAAyB;AAErD,SAASC,qBAAqB,EAAEC,qBAAqB,QAAQ,WAAW;AACxE,SAASC,uBAAuB,QAAQ,aAAa;AAGrD,OAAO,UAAUC,cAAcA,CAAC;EAAEC;AAAqC,CAAC,EAAM;EAC5E,IAAI;IACF,MAAMC,OAAY,GAAG,MAAMT,IAAI,CAACU,kBAAkB,EAAEF,OAAO,CAAC;IAC5D,MAAMR,IAAI,CAACH,GAAG,CAACc,IAAI,CAACC,cAAc,EAAEH,OAAO,CAAC;IAC5C,MAAMT,IAAI,CAACa,sBAAsB,EAAEJ,OAAO,CAAC;IAC3C,MAAMR,GAAG,CAACI,qBAAqB,CAAC,CAAC,CAAC;EACpC,CAAC,CAAC,OAAOS,KAAU,EAAE;IACnB,MAAMb,GAAG,CAACG,qBAAqB,CAACD,WAAW,CAACW,KAAK,CAAC,CAAC,CAAC;EACtD;AACF;AAEA,UAAUJ,kBAAkBA,CAACK,QAAgB,EAAE;EAC7C,IAAI;IACF;IACA,MAAMC,qBAAgE,GAAG,MAAMhB,IAAI,CACjFH,GAAG,CAACc,IAAI,CAACM,sBAAsB,EAC/BF,QACF,CAAC;IAEDlB,GAAG,CAACqB,MAAM,CAACC,KAAK,CAAC,gBAAgB,EAAE,SAAS,EAAEH,qBAAqB,CAACI,IAAI,CAAC;IAEzE,OAAOJ,qBAAqB,CAACI,IAAI;EACnC,CAAC,CAAC,OAAON,KAAU,EAAE;IACnBjB,GAAG,CAACqB,MAAM,CAACG,IAAI,CAAC,gBAAgB,EAAE,QAAQ,EAAEP,KAAK,CAAC;IAClD,MAAMb,GAAG,CAACG,qBAAqB,CAACD,WAAW,CAACW,KAAK,CAAC,CAAC,CAAC;IACpD;EACF;AACF;AAEA,UAAUD,sBAAsBA,CAACJ,OAA0B,EAAE;EAC3D,IAAI;IACF,MAAMa,QAA+B,GAAG,MAAMtB,IAAI,CAChDH,GAAG,CAACc,IAAI,CAACY,cAAc,EACvBd,OACF,CAAC;IACD,IAAIa,QAAQ,CAACF,IAAI,EAAE;MACjBvB,GAAG,CAACqB,MAAM,CAACC,KAAK,CAAC,aAAa,EAAE,SAAS,CAAC;MAC1C,MAAMlB,GAAG,CAACH,kBAAkB,CAACwB,QAAQ,CAACF,IAAI,CAAC,CAAC;MAC5C;IACF;EACF,CAAC,CAAC,OAAON,KAAK,EAAE;IACdjB,GAAG,CAACqB,MAAM,CAACG,IAAI,CAAC,aAAa,EAAE,QAAQ,EAAEP,KAAK,CAAC;EACjD,CAAC,SAAS;IACR,MAAMf,KAAK,CAAC,IAAI,CAAC;EACnB;EACA,MAAM,IAAIyB,KAAK,CAAC,2BAA2B,CAAC;AAC9C;AAEA,eAAe,UAAUC,mBAAmBA,CAAA,EAAG;EAC7C,MAAMvB,UAAU,CAACI,uBAAuB,EAAEC,cAAc,CAAC;AAC3D","ignoreList":[]}