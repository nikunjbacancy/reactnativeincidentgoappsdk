{"version":3,"names":["AsyncStorage","api","triggerOnboardForInactiveUser","Screens","PANIC_MODE_KEY","PanicMode","startEscortRequest","getIntersectOrganizationsSuccess","toggleSelectOrganization","call","delay","put","takeLatest","getCachedFineGeoPoint","NavigatorService","duressRequestError","hidePanicInfo","SHOW_PANIC_INFO","TRIGGER_DURESS_REQUEST","delayHidePanicInfo","startDuressRequest","payload","location","response","organizations","findIntersectOrganizations","data","length","_organizations$","id","setItem","Active","onLocation","navigate","Home","Escort","EscortRequest","isPanic","error","message","warningScreenSaga"],"sources":["saga.ts"],"sourcesContent":["import AsyncStorage from '@react-native-async-storage/async-storage';\nimport * as api from '../../../../api';\nimport { triggerOnboardForInactiveUser } from '../../../../containers/app/saga';\nimport Screens from '../../../../containers/providers/RoutesProvider/screens';\nimport { PANIC_MODE_KEY } from '../../../../containers/screens/Home/Escort/RecordScreen/constants';\nimport { PanicMode } from '../../../../containers/screens/Home/Escort/RecordScreen/types';\nimport { startEscortRequest } from '../../../../containers/screens/Home/Escort/RequestScreen/actions';\nimport {\n  getIntersectOrganizationsSuccess,\n  toggleSelectOrganization,\n} from '../../../../containers/screens/Home/Escort/SelectOrganizationScreen/actions';\nimport { GeoPoint, Id } from 'incident-code-core';\nimport { call, delay, put, takeLatest } from 'redux-saga/effects';\nimport { getCachedFineGeoPoint } from '../../../../utils/location';\nimport NavigatorService from '../../../../utils/navigation';\n\nimport { duressRequestError, hidePanicInfo } from './actions';\nimport { SHOW_PANIC_INFO, TRIGGER_DURESS_REQUEST } from './constants';\nimport { TriggerDuressRequestAction } from './types';\n\nfunction* delayHidePanicInfo() {\n  yield delay(3000);\n  yield put(hidePanicInfo());\n}\n\nfunction* startDuressRequest({ payload }: TriggerDuressRequestAction):any {\n  try {\n    const location: GeoPoint = yield call(getCachedFineGeoPoint);\n    const response = yield call(api.organizations.findIntersectOrganizations,location);\n    const { organizations } = response.data;\n\n    yield put(getIntersectOrganizationsSuccess(organizations));\n    if (organizations.length === 0) {\n      yield* triggerOnboardForInactiveUser();\n    } else {\n      yield put(toggleSelectOrganization(organizations[0]?.id as Id));\n    }\n    yield call(AsyncStorage.setItem, PANIC_MODE_KEY, PanicMode.Active);\n    yield put(startEscortRequest(payload.onLocation, 'Duress triggered', true));\n    yield call(NavigatorService.navigate, Screens.Home.Escort.EscortRequest, {\n      isPanic: true,\n    });\n  } catch (error: any) {\n    yield call(duressRequestError, error.message);\n  }\n}\n\nexport default function* warningScreenSaga() {\n  yield takeLatest(SHOW_PANIC_INFO, delayHidePanicInfo);\n  yield takeLatest(TRIGGER_DURESS_REQUEST, startDuressRequest);\n}\n"],"mappings":"AAAA,OAAOA,YAAY,MAAM,2CAA2C;AACpE,OAAO,KAAKC,GAAG,MAAM,iBAAiB;AACtC,SAASC,6BAA6B,QAAQ,iCAAiC;AAC/E,OAAOC,OAAO,MAAM,yDAAyD;AAC7E,SAASC,cAAc,QAAQ,mEAAmE;AAClG,SAASC,SAAS,QAAQ,+DAA+D;AACzF,SAASC,kBAAkB,QAAQ,kEAAkE;AACrG,SACEC,gCAAgC,EAChCC,wBAAwB,QACnB,6EAA6E;AAEpF,SAASC,IAAI,EAAEC,KAAK,EAAEC,GAAG,EAAEC,UAAU,QAAQ,oBAAoB;AACjE,SAASC,qBAAqB,QAAQ,4BAA4B;AAClE,OAAOC,gBAAgB,MAAM,8BAA8B;AAE3D,SAASC,kBAAkB,EAAEC,aAAa,QAAQ,WAAW;AAC7D,SAASC,eAAe,EAAEC,sBAAsB,QAAQ,aAAa;AAGrE,UAAUC,kBAAkBA,CAAA,EAAG;EAC7B,MAAMT,KAAK,CAAC,IAAI,CAAC;EACjB,MAAMC,GAAG,CAACK,aAAa,CAAC,CAAC,CAAC;AAC5B;AAEA,UAAUI,kBAAkBA,CAAC;EAAEC;AAAoC,CAAC,EAAM;EACxE,IAAI;IACF,MAAMC,QAAkB,GAAG,MAAMb,IAAI,CAACI,qBAAqB,CAAC;IAC5D,MAAMU,QAAQ,GAAG,MAAMd,IAAI,CAACR,GAAG,CAACuB,aAAa,CAACC,0BAA0B,EAACH,QAAQ,CAAC;IAClF,MAAM;MAAEE;IAAc,CAAC,GAAGD,QAAQ,CAACG,IAAI;IAEvC,MAAMf,GAAG,CAACJ,gCAAgC,CAACiB,aAAa,CAAC,CAAC;IAC1D,IAAIA,aAAa,CAACG,MAAM,KAAK,CAAC,EAAE;MAC9B,OAAOzB,6BAA6B,CAAC,CAAC;IACxC,CAAC,MAAM;MAAA,IAAA0B,eAAA;MACL,MAAMjB,GAAG,CAACH,wBAAwB,EAAAoB,eAAA,GAACJ,aAAa,CAAC,CAAC,CAAC,cAAAI,eAAA,uBAAhBA,eAAA,CAAkBC,EAAQ,CAAC,CAAC;IACjE;IACA,MAAMpB,IAAI,CAACT,YAAY,CAAC8B,OAAO,EAAE1B,cAAc,EAAEC,SAAS,CAAC0B,MAAM,CAAC;IAClE,MAAMpB,GAAG,CAACL,kBAAkB,CAACe,OAAO,CAACW,UAAU,EAAE,kBAAkB,EAAE,IAAI,CAAC,CAAC;IAC3E,MAAMvB,IAAI,CAACK,gBAAgB,CAACmB,QAAQ,EAAE9B,OAAO,CAAC+B,IAAI,CAACC,MAAM,CAACC,aAAa,EAAE;MACvEC,OAAO,EAAE;IACX,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOC,KAAU,EAAE;IACnB,MAAM7B,IAAI,CAACM,kBAAkB,EAAEuB,KAAK,CAACC,OAAO,CAAC;EAC/C;AACF;AAEA,eAAe,UAAUC,iBAAiBA,CAAA,EAAG;EAC3C,MAAM5B,UAAU,CAACK,eAAe,EAAEE,kBAAkB,CAAC;EACrD,MAAMP,UAAU,CAACM,sBAAsB,EAAEE,kBAAkB,CAAC;AAC9D","ignoreList":[]}