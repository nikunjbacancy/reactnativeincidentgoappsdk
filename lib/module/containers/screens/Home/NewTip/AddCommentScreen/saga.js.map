{"version":3,"names":["api","makeSelectNewTipIncidentActionRequest","makeSelectNewTipOrganization","removeScreenAction","call","put","select","takeLatest","handleError","getCachedFineGeoPoint","NavigatorService","deleteIncidentSuccess","showTipCreatedModal","CreateTipMode","addComment","createTipFailure","createTipSuccess","CREATE_TIP_REQUEST","createTip","payload","comment","incidentActionRequest","organization","incidents","doIncidentAction","response","getIncident","id","incident","data","hasChat","createTipMode","Chat","location","startChat","category","organizationName","name","popToTop","error","addCommentScreenSaga"],"sources":["saga.ts"],"sourcesContent":["/**\n *\n * AddCommentScreen saga\n *\n */\n\nimport * as api from '../../../../../api';\nimport { AxiosResponse } from 'axios';\nimport {\n  makeSelectNewTipIncidentActionRequest,\n  makeSelectNewTipOrganization,\n} from '../../../../../containers/app/selectors';\nimport { removeScreenAction } from '../../../../../containers/providers/RoutesProvider/actions';\nimport {\n  Id,\n  Incident,\n  IncidentActionRequest,\n  Organization,\n} from 'incident-code-core';\nimport { call, put, select, takeLatest } from 'redux-saga/effects';\nimport { handleError } from '../../../../../utils/error';\nimport { getCachedFineGeoPoint } from '../../../../../utils/location';\nimport NavigatorService from '../../../../../utils/navigation';\n\nimport {\n  deleteIncidentSuccess,\n  showTipCreatedModal,\n} from '../VideoRecordScreen/actions';\nimport { CreateTipMode } from '../VideoRecordScreen/types';\nimport { addComment, createTipFailure, createTipSuccess } from './actions';\nimport { CREATE_TIP_REQUEST } from './constants';\nimport { CreateTipRequestAction } from './types';\n\nfunction* createTip({ payload }: CreateTipRequestAction): any {\n  yield put(addComment(payload.comment));\n  const incidentActionRequest: IncidentActionRequest = yield select(\n    makeSelectNewTipIncidentActionRequest(),\n  );\n  const organization: Organization = yield select(\n    makeSelectNewTipOrganization(),\n  );\n  try {\n    yield call(api.incidents.doIncidentAction, incidentActionRequest);\n    yield put(deleteIncidentSuccess());\n    yield put(removeScreenAction());\n    const response: AxiosResponse<Incident> = yield call(\n      api.incidents.getIncident,\n      incidentActionRequest.id as Id,\n    );\n\n    const incident = response.data;\n\n    if (!incident.hasChat && payload.createTipMode === CreateTipMode.Chat) {\n      const location = yield call(getCachedFineGeoPoint);\n      yield call(api.incidents.startChat, {\n        incident: incident.id as Id,\n        organization: organization.id as Id,\n        category: incident.category,\n        comment: incident.comment,\n        location,\n      });\n\n      incident.hasChat = true;\n    }\n\n    yield put(createTipSuccess());\n\n    yield put(\n      showTipCreatedModal({\n        incident,\n        organizationName: organization.name,\n      }),\n    );\n    yield call(NavigatorService.popToTop);\n  } catch (error: any) {\n    yield put(createTipFailure(handleError(error)));\n  }\n}\n\nexport default function* addCommentScreenSaga() {\n  yield takeLatest(CREATE_TIP_REQUEST, createTip);\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAO,KAAKA,GAAG,MAAM,oBAAoB;AAEzC,SACEC,qCAAqC,EACrCC,4BAA4B,QACvB,yCAAyC;AAChD,SAASC,kBAAkB,QAAQ,4DAA4D;AAO/F,SAASC,IAAI,EAAEC,GAAG,EAAEC,MAAM,EAAEC,UAAU,QAAQ,oBAAoB;AAClE,SAASC,WAAW,QAAQ,4BAA4B;AACxD,SAASC,qBAAqB,QAAQ,+BAA+B;AACrE,OAAOC,gBAAgB,MAAM,iCAAiC;AAE9D,SACEC,qBAAqB,EACrBC,mBAAmB,QACd,8BAA8B;AACrC,SAASC,aAAa,QAAQ,4BAA4B;AAC1D,SAASC,UAAU,EAAEC,gBAAgB,EAAEC,gBAAgB,QAAQ,WAAW;AAC1E,SAASC,kBAAkB,QAAQ,aAAa;AAGhD,UAAUC,SAASA,CAAC;EAAEC;AAAgC,CAAC,EAAO;EAC5D,MAAMd,GAAG,CAACS,UAAU,CAACK,OAAO,CAACC,OAAO,CAAC,CAAC;EACtC,MAAMC,qBAA4C,GAAG,MAAMf,MAAM,CAC/DL,qCAAqC,CAAC,CACxC,CAAC;EACD,MAAMqB,YAA0B,GAAG,MAAMhB,MAAM,CAC7CJ,4BAA4B,CAAC,CAC/B,CAAC;EACD,IAAI;IACF,MAAME,IAAI,CAACJ,GAAG,CAACuB,SAAS,CAACC,gBAAgB,EAAEH,qBAAqB,CAAC;IACjE,MAAMhB,GAAG,CAACM,qBAAqB,CAAC,CAAC,CAAC;IAClC,MAAMN,GAAG,CAACF,kBAAkB,CAAC,CAAC,CAAC;IAC/B,MAAMsB,QAAiC,GAAG,MAAMrB,IAAI,CAClDJ,GAAG,CAACuB,SAAS,CAACG,WAAW,EACzBL,qBAAqB,CAACM,EACxB,CAAC;IAED,MAAMC,QAAQ,GAAGH,QAAQ,CAACI,IAAI;IAE9B,IAAI,CAACD,QAAQ,CAACE,OAAO,IAAIX,OAAO,CAACY,aAAa,KAAKlB,aAAa,CAACmB,IAAI,EAAE;MACrE,MAAMC,QAAQ,GAAG,MAAM7B,IAAI,CAACK,qBAAqB,CAAC;MAClD,MAAML,IAAI,CAACJ,GAAG,CAACuB,SAAS,CAACW,SAAS,EAAE;QAClCN,QAAQ,EAAEA,QAAQ,CAACD,EAAQ;QAC3BL,YAAY,EAAEA,YAAY,CAACK,EAAQ;QACnCQ,QAAQ,EAAEP,QAAQ,CAACO,QAAQ;QAC3Bf,OAAO,EAAEQ,QAAQ,CAACR,OAAO;QACzBa;MACF,CAAC,CAAC;MAEFL,QAAQ,CAACE,OAAO,GAAG,IAAI;IACzB;IAEA,MAAMzB,GAAG,CAACW,gBAAgB,CAAC,CAAC,CAAC;IAE7B,MAAMX,GAAG,CACPO,mBAAmB,CAAC;MAClBgB,QAAQ;MACRQ,gBAAgB,EAAEd,YAAY,CAACe;IACjC,CAAC,CACH,CAAC;IACD,MAAMjC,IAAI,CAACM,gBAAgB,CAAC4B,QAAQ,CAAC;EACvC,CAAC,CAAC,OAAOC,KAAU,EAAE;IACnB,MAAMlC,GAAG,CAACU,gBAAgB,CAACP,WAAW,CAAC+B,KAAK,CAAC,CAAC,CAAC;EACjD;AACF;AAEA,eAAe,UAAUC,oBAAoBA,CAAA,EAAG;EAC9C,MAAMjC,UAAU,CAACU,kBAAkB,EAAEC,SAAS,CAAC;AACjD","ignoreList":[]}