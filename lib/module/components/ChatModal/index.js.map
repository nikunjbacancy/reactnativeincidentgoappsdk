{"version":3,"names":["images","makeSelectGiftedChatUser","forEach","React","memo","useCallback","useEffect","useState","useIntl","View","GiftedChat","Modal","useSelector","styled","uuid","IconButton","chatMessage","ChatModal","isVisible","hideModal","onShow","onHide","messages","onMessageSent","isReadMode","formatMessage","user","messagesWithPending","setMessagesWithPending","handleSendMessage","messagesToSent","message","pending","prevState","append","getGiftedChatMessage","text","_id","createdAt","Date","emptyInput","createElement","useNativeDriver","animationIn","animationOut","onBackButtonPress","onBackdropPress","onModalWillShow","onModalWillHide","style","margin","justifyContent","Container","CloseButton","source","icClose","onPress","Content","onSend","renderChatFooter","ChatFooter","TagContainer","iNeedHelp","Tag","someoneSuspicious","renderInputToolbar","undefined","theme","colors","white","TouchableOpacity","dark","Text","fonts","defaultFamily","normalSize"],"sources":["index.tsx"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport { images } from '../../assets';\nimport { makeSelectGiftedChatUser } from '../../containers/app/selectors';\nimport { Organization } from 'incident-code-core';\nimport forEach from 'lodash/forEach';\nimport React, { FC, memo, useCallback, useEffect, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { View } from 'react-native';\nimport {\n  GiftedChat,\n  IMessage as GiftedChatMessage,\n} from 'react-native-gifted-chat';\nimport Modal from 'react-native-modal';\nimport { useSelector } from '../../utils/hooks';\nimport styled from '../../utils/styled';\nimport uuid from 'uuid/v4';\n\nimport IconButton from '../IconButton';\nimport chatMessage from './messages';\n\ntype Props = {\n  isVisible: boolean;\n  hideModal(): void;\n  onShow?(): void;\n  onHide?(): void;\n  organization: Organization;\n  messages: GiftedChatMessage[];\n  onMessageSent(message: GiftedChatMessage[]): void;\n  isReadMode?: boolean;\n};\n\nconst ChatModal: FC<Props> = ({\n  isVisible,\n  hideModal,\n  onShow,\n  onHide,\n  messages,\n  onMessageSent,\n  isReadMode,\n}) => {\n  const { formatMessage } = useIntl();\n  const user = useSelector(makeSelectGiftedChatUser());\n\n  const [messagesWithPending, setMessagesWithPending] = useState(messages);\n\n  useEffect(() => {\n    setMessagesWithPending(messages);\n  }, [messages]);\n\n  const handleSendMessage = useCallback(\n    (messagesToSent: GiftedChatMessage[]) => {\n      forEach(messagesToSent, message => {\n        message.pending = true;\n      });\n\n      setMessagesWithPending(prevState =>\n        GiftedChat.append(prevState, messagesToSent),\n      );\n\n      onMessageSent(messagesToSent);\n    },\n    [],\n  );\n  const getGiftedChatMessage = useCallback(\n    (text: string): GiftedChatMessage[] => [\n      {\n        _id: uuid(),\n        text,\n        createdAt: new Date(),\n        user,\n      },\n    ],\n    [],\n  );\n  const emptyInput = () => <View />;\n  return (\n    <Modal\n      useNativeDriver={true}\n      animationIn=\"slideInUp\"\n      animationOut=\"slideOutDown\"\n      isVisible={isVisible}\n      onBackButtonPress={hideModal}\n      onBackdropPress={hideModal}\n      onModalWillShow={onShow}\n      onModalWillHide={onHide}\n      style={{ margin: 0, justifyContent: 'flex-end' }}\n    >\n      <Container>\n        <CloseButton source={images.icClose()} onPress={hideModal} />\n        <Content>\n          <GiftedChat\n            user={user}\n            messages={messagesWithPending}\n            onSend={handleSendMessage}\n            renderChatFooter={() => (\n              <ChatFooter>\n                <TagContainer\n                  onPress={() =>\n                    handleSendMessage(\n                      getGiftedChatMessage(\n                        formatMessage(chatMessage.iNeedHelp),\n                      ),\n                    )\n                  }\n                >\n                  <Tag>{formatMessage(chatMessage.iNeedHelp)}</Tag>\n                </TagContainer>\n                <TagContainer\n                  onPress={() =>\n                    handleSendMessage(\n                      getGiftedChatMessage(\n                        formatMessage(chatMessage.someoneSuspicious),\n                      ),\n                    )\n                  }\n                >\n                  <Tag>{formatMessage(chatMessage.someoneSuspicious)}</Tag>\n                </TagContainer>\n              </ChatFooter>\n            )}\n            renderInputToolbar={isReadMode ? emptyInput : undefined}\n          />\n        </Content>\n      </Container>\n    </Modal>\n  );\n};\n\nconst Container = styled.View`\n  background-color: ${({ theme }) => theme.colors.white};\n  border-top-left-radius: 20px;\n  border-top-right-radius: 20px;\n  height: 80%;\n  width: 100%;\n  display: flex;\n  position: relative;\n`;\n\nconst Content = styled.View`\n  flex: 1;\n  padding: 15px 15px 25px;\n`;\n\nconst CloseButton = styled(IconButton as any)`\n  width: 44px;\n  height: 44px;\n  border-radius: 22px;\n  background-color: ${({ theme }) => theme.colors.white};\n  position: absolute;\n  top: -60px;\n  right: 20px;\n`;\n\nconst ChatFooter = styled.View`\n  height: 44px;\n  flex-wrap: wrap;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst TagContainer = styled.TouchableOpacity`\n  border: 0.5px solid ${({ theme }) => theme.colors.dark};\n  justify-content: center;\n  align-items: center;\n  margin-left: 3px;\n  margin-right: 3px;\n  padding: 5px 10px;\n  border-radius: 3px;\n`;\n\nconst Tag = styled.Text`\n  font-family: ${({ theme }) => theme.fonts.defaultFamily};\n  font-size: ${({ theme }) => theme.fonts.normalSize};\n  color: ${({ theme }) => theme.colors.dark};\n  font-weight: 100;\n`;\n\nexport default memo(ChatModal);\n"],"mappings":"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","ignoreList":[]}