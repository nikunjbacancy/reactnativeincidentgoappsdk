{"version":3,"names":["React","PropTypes","View","Image","StyleSheet","TouchableOpacity","Platform","Alert","launchCamera","launchImageLibrary","ImageResizer","RNFS","requestPhotoLibraryPermissions","openSettings","MyPhotoUpload","Component","constructor","args","_defineProperty","maxHeight","props","height","maxWidth","width","format","quality","buttonDisabled","title","photoPickerTitle","storageOptions","skipBackup","path","mediaType","includeBase64","imagePickerProps","permission","e","setState","onStart","options","response","rotation","originalRotation","onResponse","didCancel","console","log","onCancel","error","onError","customButton","onTapCustomButton","state","imageURI","assets","map","uri","resizedImageUri","createResizedImage","onResizedImageUri","filePath","OS","replace","photoData","readFile","source","avatarSource","onPhotoSelect","alert","alertTitle","alertMessage","text","onPress","style","Children","children","child","type","cloneElement","componentDidUpdate","onAfterRender","render","createElement","styles","container","containerStyle","openImagePicker","disabled","renderChildren","object","string","number","func","onRender","create","flex","justifyContent","alignItems"],"sources":["MyPhotoUpload.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  View,\n  Image,\n  StyleSheet,\n  TouchableOpacity,\n  Platform,\n  Alert\n} from 'react-native'\n// import ImagePicker from 'react-native-image-picker'\nimport { launchCamera, launchImageLibrary } from 'react-native-image-picker';\nimport ImageResizer from 'react-native-image-resizer'\nimport RNFS from 'react-native-fs'\nimport { requestPhotoLibraryPermissions } from '../../utils/permission';\nimport { openSettings } from 'react-native-permissions';\n\nexport default class MyPhotoUpload extends React.Component {\n  static propTypes = {\n    containerStyle: PropTypes.object,\n    photoPickerTitle: PropTypes.string,\n    maxHeight: PropTypes.number,\n    maxWidth: PropTypes.number,\n    format: PropTypes.string,\n    quality: PropTypes.number,\n    onPhotoSelect: PropTypes.func, // returns the base64 string of uploaded photo\n    onError: PropTypes.func, // if any error occur with response\n    onTapCustomButton: PropTypes.func, // on tap custom button\n    onStart: PropTypes.func, // when user starts (useful for loading, etc)\n    onCancel: PropTypes.func, // when user cancel\n    onResponse: PropTypes.func, // on response exists!\n    onRender: PropTypes.func, // after render\n    onResizedImageUri: PropTypes.func, // when image resized is ready\n    imagePickerProps: PropTypes.object, // react-native-image-picker props\n    alertTitle: PropTypes.string,\n    alertMessage:PropTypes.string,\n  }\n\n  state = {\n    maxHeight: this.props.height || 600,\n    maxWidth: this.props.width || 600,\n    format: this.props.format || 'JPEG',\n    quality: this.props.quality || 100,\n    buttonDisabled: false\n  }\n\n  options = {\n    title: this.props.photoPickerTitle || 'Select Photo',\n    storageOptions: {\n      skipBackup: true,\n      path: 'images',\n      mediaType: 'photo',\n      includeBase64: true\n    },\n    ...this.props.imagePickerProps\n  }\n\n  openImagePicker = async () => {\n\n    var permission = \"\"\n    try {\n      permission = await requestPhotoLibraryPermissions()\n    } catch (e) {\n      permission = e\n    }\n    if (permission === \"granted\") {\n\n\n      this.setState({ buttonDisabled: true })\n      if (this.props.onStart) this.props.onStart()\n\n      // get image from image picker\n      launchImageLibrary(this.options, async response => {\n        this.setState({ buttonDisabled: false })\n\n        let rotation = 0\n        const { originalRotation } = response\n\n\n        if (this.props.onResponse) this.props.onResponse(response)\n\n        if (response.didCancel) {\n          console.log('User cancelled image picker')\n          if (this.props.onCancel) this.props.onCancel('User cancelled image picker')\n          return\n        } else if (response.error) {\n          console.log('ImagePicker Error: ', response.error)\n          if (this.props.onError) this.props.onError(response.error)\n          return\n        } else if (response.customButton) {\n          console.log('User tapped custom button: ', response.customButton)\n          if (this.props.onTapCustomButton) this.props.onTapCustomButton(response.customButton)\n          return\n        }\n\n        let { maxHeight, maxWidth, quality, format } = this.state\n\n        //Determining rotation param\n        if (originalRotation === 90) {\n          rotation = 90\n        } else if (originalRotation === 180) {\n          //For a few images rotation is 180. \n          rotation = -180\n        } else if (originalRotation === 270) {\n          //When taking images with the front camera (selfie), the rotation is 270.\n          rotation = -90\n        }\n\n        var imageURI = \"\"\n        response?.assets.map(({ uri }) => (\n          imageURI = uri\n        ))\n        // resize image\n        const resizedImageUri = await ImageResizer.createResizedImage(\n          imageURI,\n          maxHeight,\n          maxWidth,\n          format,\n          quality,\n          rotation\n        )\n\n        if (this.props.onResizedImageUri) this.props.onResizedImageUri(resizedImageUri)\n\n        const filePath = Platform.OS === 'android' && resizedImageUri.uri.replace\n          ? resizedImageUri.uri.replace('file:/data', '/data')\n          : resizedImageUri.uri\n\n\n        // convert image back to base64 string\n        const photoData = await RNFS.readFile(filePath, 'base64')\n        let source = { uri: resizedImageUri.uri }\n        this.setState({\n          avatarSource: source\n        })\n\n        // handle photo in props functions as data string\n        if (this.props.onPhotoSelect) this.props.onPhotoSelect(photoData)\n      })\n    } else {\n      Alert.alert(\n        this.props.alertTitle,\n        this.props.alertMessage,\n        [\n          {\n            text: \"Cancel\",\n            onPress: () => console.log(\"Cancel Pressed\"),\n            style: \"cancel\"\n          },\n          { text: \"Settings\", onPress: () => openSettings() }\n        ]\n      );\n    }\n  }\n\n  renderChildren = props => {\n    return React.Children.map(props.children, child => {\n      if (child && child.type === Image && this.state.avatarSource) {\n        return React.cloneElement(child, {\n          source: this.state.avatarSource\n        })\n      } else return child\n    })\n  }\n\n  componentDidUpdate() {\n    if (this.props.onAfterRender) this.props.onAfterRender(this.state)\n  }\n\n  render() {\n    return (\n      <View style={[styles.container, this.props.containerStyle]}>\n        <TouchableOpacity\n          onPress={this.openImagePicker}\n          disabled={this.state.buttonDisabled}\n        >\n          {this.renderChildren(this.props)}\n        </TouchableOpacity>\n      </View>\n    )\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center'\n  }\n})\n"],"mappings":"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","ignoreList":[]}